# Analysis: predicting farmer question topics based on the weather

The goal of the analyses here was to generate a predictive model to anticipate farmer question topics based on the weather forecast. The predictions generated by this model should not be treated as definitive but instead be used to highlight topics to be prepared for.

This folder contains the code and supplemental data necessary to train and use the model.

**Question_Prediction_Model.ipynb** - this Jupyter notebook contains the code necessary to make the model. Adjust filepaths and filenames as needed in the first cell.  
**Topic_prediction_app.py** - this simple app can be launched locally to interact with the model and generate predictions from user input.  
**QTOPIC.pkl, QTOPIC.joblib** - these are the same final model, uploaded in two different file formats. The same model is also uploaded to the Google Drive as _Challenge1_topic_prediction_rfmodel.pkl_.  
**UGA_weather_data.csv, KEN_weather_data.csv, TZA_weather_data.csv** - these datasets contain the weather data used to train and test the model. These datasets were helpfully prepared and shared by another DataKit participant, [İbrahim Yücel](https://github.com/ibraahimycl/datakit-smallholder-farmers-fall-2025/tree/main/Challenge%201%20_Weather%20Patterns/ibrahim-yucel/weather-data).

### What the model is

This is a random forest classifier model. A few weather-related features (minimum temp, maximum temp, precipitation, and relative humidity) are used to predict the topics of the questions that farmers asked. The model will generate a prediction for one of 11 question topics that appeared in the We Farm dataset: 'bean', 'cattle', 'chicken', 'coffee', 'goat', 'maize', 'pig', 'potato', 'poultry', 'rabbit', and 'tomato'.

### Why these 11 topics?

Topics were chosen to be useful while also working within this weather model. All of the chosen topics made up at least 2% of total questions in the dataset, and collectively these topics accounted for ~65% of all questions. Rarer topics would have been difficult to include due to having less data than the other topics (both over- and under-sampling techniques were tested, but neither improved the model). 

A small number of common topics were also excluded either because the model could not connect the weather data to the topic, or because the qusetions under that topic were broad enough to make it less helpful (e.g., 'plant', 'crop', or 'animal'). For similar reasons, the model does not include any engineered 'miscellaneous' topics made from the rarer topics.

### How well did weather predict question topic?

The model achieved a modest F1 score of 0.19. Associations between the weather features used and the topics were generally weak, with the strongest Pearson correlation observed between any weather feature and an individual topic being 0.12. Models built for individual countries generally performed worse than the final, combined countries model presented here.

While the model generates a prediction better than chance guessing among these topics, outputs should be taken as suggestions of what to anticipate rather than authoritative guidance.

### Future directions

The weather data used here were from monthly averages/total in these countries. Examining this question with better temporal resolution in the weather data (daily or weekly) may strengthen the model.

Question topics should also be examined further, if possible. While no glaring problems were uncovered with the topics incorporated into the model, exploration of the data suggests some other labels are frequently a poor fit for their question content. For example, many of the questions under the topic 'camel' are actually about a bacterial disease affecting bananas, and while 'pigeon' does contain some questions related to the bird many are completely unrelated. Other topics may benefit from more sophisticated parsing; 'cat', for example, includes questions about cats, but also about cat fish and cat erpillers.

### Python packages used in this repo

numpy==1.26.4  
pandas==1.4.4  
scikit-learn==1.0.4  
joblib==1.5.2  
streamlit==1.50.0

### Generative AI usage

Generative AI was used to generate code for a couple simple exploratory analyses (not included here) and pre-processing steps. All other code was created by myself or adapted from other human-made code. All documentation, insights, and judgments are my own. 
